
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>���� ����</title>
</head>
<body>
<script type="text/javascript" src="//s.zigbang.com/js/cdnjs-jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="//s.zigbang.com/js/cdnjs-jquery-xdomainrequest/1.0.3/jquery.xdomainrequest.min.js"></script>
	<div id="review_write_wrap">
    <article id="step_search" class="step" style="display: none;">
        <h3><span class="zbIcon icon-question2"></span>  최근 5년 이내에<br> <span class="apt_name"></span> 아파트에 거주한  경험이 있나요?</h3>
        <div class="item1">
            <button type="button" class="btn" id="q_condition_no">아니오</button>
            <button type="button" class="btn active" id="q_condition_yes">네</button>
        </div>
        <div class="btn_steps">
            <button type="button" id="btn_search_next" class="btn_next">다음 <span class="zbIcon icon-next2"></span></button>
        </div>
    </article>

    <article id="step_survey1" class="step" style="display: block;">
        <h3><span class="zbIcon icon-write"></span><span class="apt_name"></span>  아파트에 대해 아래의 항목들을 입력해주세요.</h3>

        <section class="item_question active" data-question="q1">
            <h4><em class="zbIcon icon-check_off"></em>  <em class="zbIcon icon-check_on"></em>  <strong>교통여건</strong> <span class="zbIcon icon-arrow"></span></h4>
            <p class="i_title">대중교통 이용이나, 자동차 운행과 같은 교통여건에 대해 말씀해주세요.  (50자 이상)</p>
            <div class="i_star">
                <span class="i_bad">매우불편</span>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <span class="i_good">매우편리</span>
            </div>
            <p class="i_ex">
                (예시) 삼각지역이 도보 3분 거리이고, 종각으로 가는
                501버스를 집 바로 앞 버스정류장에서 탈 수 있다.
                배차 간격이 짧아 출퇴근이 편리하다.
                하지만 서울역이 근처에 있어서 차가 항상 막혀,
                자가용 이용은 자제하려고 한다.
            </p>
            <div class="i_textarea" style="position:relative;">
                <textarea placeholder="교통 여건의 장단점을 입력해주세요" oninput="chkword(this,500);"></textarea>
                <p class="warn" style="position:absolute;bottom:5px;right:10px;color:red;">0 / 500</p>
            </div>
        </section>

        <section class="item_question" data-question="q2">
            <h4><em class="zbIcon icon-check_off"></em>  <em class="zbIcon icon-check_on"></em> <strong>주변환경</strong> <span class="zbIcon icon-arrow"></span></h4>
            <p class="i_title">슈퍼(편의점), 백화점(대형마트), 산책로, 공원 등의 주변 환경에 대해 말씀해주세요. (50자 이상) </p>
            <div class="i_star">
                <span class="i_bad">매우부족</span>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <span class="i_good">매우충분</span>
            </div>
            <p class="i_ex">
                (예시) 마을 버스로 2 정거장이면 용산역 이마트도 있고, 정문 앞에 신선한 야채를 파는 레몬 마트가 있어서
                장을 보기 편하다. 용산가족공원 바로 아래에 위치한
                아파트여서, 아이들을 자주 데리고 나간다. 공기도
                주변 아파트보다 더 맑은 느낌이다.
            </p>

            <div class="i_textarea" style="position:relative;">

                <textarea placeholder="주변환경의 장단점을 입력해주세요" oninput="chkword(this,500);"></textarea>
                <p class="warn" style="position:absolute;bottom:5px;right:10px;color:red;">0 / 500</p>
            </div>
        </section>

        <section class="item_question" data-question="q3">
            <h4><em class="zbIcon icon-check_off"></em>  <em class="zbIcon icon-check_on"></em> <strong>단지관리</strong> <span class="zbIcon icon-arrow"></span></h4>
            <p class="i_title">단지 청소, 출입 통제, 주차장관리, 택배 보관 등 단지 관리 상태에 대해 말씀해주세요.  (50자 이상)</p>
            <div class="i_star">
                <span class="i_bad">매우나쁨</span>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <span class="i_good">매우좋음</span>
            </div>
            <p class="i_ex">
                (예시) 공용 현관의 비밀 번호를 자주 바꿔서 잡상인이
                아파트 안으로 들어오지 못 해 안전하다. 택배를 경비
                아저씨가 경비 초소 한 켠에 모아두시다 보니, 한 번
                잃어버린 적이 있어 불안하지만, 관리비가 저렴해서
                그냥 만족한다.
            </p>

            <div class="i_textarea" style="position:relative;">

                <textarea placeholder="단지관리의 장단점을 입력해주세요" oninput="chkword(this,500);"></textarea>
                <p class="warn" style="position:absolute;bottom:5px;right:10px;color:red;">0 / 500</p>
            </div>
        </section>

        <section class="item_question" data-question="q4">
            <h4><em class="zbIcon icon-check_off"></em> <em class="zbIcon icon-check_on"></em>  <strong>거주환경</strong> <span class="zbIcon icon-arrow"></span></h4>
            <p class="i_title">냉난방, 일조량, 층간 소음과 같은 거주 환경을 말씀해주세요.  (50자 이상) </p>
            <div class="i_star">
                <span class="i_bad">매우나쁨</span>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <span class="i_good">매우좋음</span>
            </div>
            <p class="i_ex">
                (예시) 베란다가 넓게 트여있지 않아 바람이 덜 들어와
                여름에는 에어콘을 항상 켜야 한다. 하지만 정남향
                아파트라서 하루 종일 햇빛이 잘 들어와, 겨울에는
                난방을 덜 할 수 있을 정도로 따뜻하다. 오래된
                아파트라서 층간 소음이 조금 있어, 아이들이 뛰어
                놀지 못 하게 하느라 조금 답답하다.
            </p>

            <div class="i_textarea" style="position:relative;">

                <textarea placeholder="거주 환경의 장단점을 입력해주세요." oninput="chkword(this,500);"></textarea>
                <p class="warn" style="position:absolute;bottom:5px;right:10px;color:red;">0 / 500</p>
            </div>
        </section>

        <section class="item_question" data-question="q5">
            <h4><em class="zbIcon icon-check_off"></em> <em class="zbIcon icon-check_on"></em> <strong>아파트추천</strong> <span class="zbIcon icon-arrow"></span></h4>
            <p class="i_title">리뷰해주신 아파트를 주변 사람에게 추천하나요? 이유를 말씀해주세요.  (50자 이상)</p>
            <div class="i_star">
                <span class="i_bad">비<br>추천</span>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <em class="zbIcon i-star icon-star_off"></em>
                <span class="i_good">매우추천</span>
            </div>
            <p class="i_ex">
                (예시) 가까이에 대형 마트, 백화점도 있고 용산 가족
                공원도 걸어 갈 수 있어서, 주변 환경에 매우 만족한다.
                이용할 수 있는 지하철, 버스 노선도 다양해서 출퇴근이 편리한데, 주변 아파트에 비해 가격이 저렴하다.
                내부 시설도 살기 좋지만, 층간 소음이 약간 있어서
                4점을 주었다.
            </p>

            <div class="i_textarea" style="position:relative;">

                <textarea placeholder="리뷰해주신 아파트를 주변사람에게 추천하는 이유를 말씀해주세요" oninput="chkword(this,500);"></textarea>
                <p class="warn" style="position:absolute;bottom:5px;right:10px;color:red;">0 / 500</p>
            </div>
        </section>

        <section class="item_question" data-question="q6">
            <h4><em class="zbIcon icon-check_off"></em> <em class="zbIcon icon-check_on"></em> <strong>동/층 정보</strong> <span class="zbIcon icon-arrow"></span></h4>
            <p class="i_title">거주 하셨던 동, 층 정보를 입력해 주세요.</p>
            <div id="i_dong" class="i_dong"><input type="text" id="dong" placeholder="동 입력"><input type="text" id="floor" placeholder="층 입력"></div>
        </section>
        <div class="btn_steps">
            <button type="button" id="btn_step1_next" class="btn_next">다음 <span class="zbIcon icon-next2"></span></button>
        </div>
    </article>

    <article id="step_survey2" class="step" style="display: none;">
        <h4 class="none">리뷰해주신 아파트의 거주형태는?</h4>
        <div class="i_btn type_2">
            <button type="button" class="q_type">자가 거주</button>
            <button type="button" class="q_type">전세 또는 월세</button>
        </div>
        <h4>아파트에 거주하셨던 시기는?</h4>
        <div class="i_btn type_6">
            <button type="button" class="q_time">2013년까지</button>
            <button type="button" class="q_time">2014년까지</button>
            <button type="button" class="q_time">2015년까지</button>
            <button type="button" class="q_time">2016년까지</button>
            <button type="button" class="q_time">2017년까지</button>
            <button type="button" class="q_time">현재 거주 중</button>
        </div>
        <h4>작성해주시는 분의 연령대는?</h4>
        <div class="i_btn type_5">
            <button type="button" class="q_age">20대</button>
            <button type="button" class="q_age">30대</button>
            <button type="button" class="q_age">40대</button>
            <button type="button" class="q_age">50대</button>
            <button type="button" class="q_age">60대 이상</button>
        </div>
        <h4>작성해주시는 분의 성별은?</h4>
        <div class="i_btn type_2">
            <button type="button" class="q_sex">남자</button>
            <button type="button" class="q_sex">여자</button>
        </div>
        <h4>결혼 여부를 알려주세요.</h4>
        <div class="i_btn type_2">
            <button type="button" class="q_maried">기혼</button>
            <button type="button" class="q_maried">미혼</button>
        </div>
        <div class="btn_steps">
            <button type="button" class="btn_next" id="btn_step2_next">리뷰 제출하기 <span class="zbIcon icon-next2"></span></button>
        </div>
    </article>

    <article id="step_message" class="step" style="display: none;">
        <div id="i_fail" class="item">
            <img src="//s.zigbang.com/event/apt_review/img_apt.png"><br>
            아쉽지만, 최근 5년 이내에 <span class="apt_name"></span>아파트에 <br>거주하신 분만 리뷰를 작성하실 수 있어요.<br>참여해주셔서 정말 감사합니다.
            <a href="javascript:void(0);" id="btn_msg_1" class="btn_orange">확인</a>
        </div>
    </article>
    <div id="toast">
        <p></p>
    </div>

    <div id="dim"></div>
    <script type="text/javascript" src="//s.zigbang.com/js/cdnjs-jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="//s.zigbang.com/js/cdnjs-jquery-xdomainrequest/1.0.3/jquery.xdomainrequest.min.js"></script>

    <script>
        var getParameter = function (param) {
            var returnValue;
            var url = location.href;
            var parameters = (url.slice(url.indexOf('?') + 1, url.length)).split('&');
            for (var i = 0; i < parameters.length; i++) {
                var varName = parameters[i].split('=')[0];
                if (varName.toUpperCase() == param.toUpperCase()) {
                    returnValue = parameters[i].split('=')[1];
                    return decodeURIComponent(returnValue);
                }
            }
        };

        function detectmob() {
            if( navigator.userAgent.match(/Android/i)
                || navigator.userAgent.match(/webOS/i)
                || navigator.userAgent.match(/iPhone/i)
                || navigator.userAgent.match(/iPad/i)
                || navigator.userAgent.match(/iPod/i)
                || navigator.userAgent.match(/BlackBerry/i)
                || navigator.userAgent.match(/Windows Phone/i)
            ){
                return true;
            }
            else {
                return false;
            }
        }
        var surveyItem = {
            item : {
                aptName: '',
                aptId: '',
                userPhone: '',
                dongs: {},
                questions: {
                    detail: [
                        {
                            title: '교통여건',
                            contents: '',
                            star: 0
                        },
                        {
                            title: '주변환경',
                            contents: '',
                            star: 0
                        },
                        {
                            title: '단지관리',
                            contents: '',
                            star: 0
                        },
                        {
                            title: '거주환경',
                            contents: '',
                            star: 0
                        },
                        {
                            title: '아파트추천',
                            contents: '',
                            star: 0
                        }
                    ],
                    qType: '',
                    qTime: '',
                    qAge: '',
                    qSex: '',
                    qMarried: '',
                    qDong: '',
                    qFloor:0,
                }
            }
        };

        var surveySubmitItem =  {
            "trafficScore": 1,
            "trafficDesc": "1교통여건",
            "aroundScore": 1,
            "aroundDesc": "1주변환경",
            "careScore": 1,
            "careDesc": "1단지관리",
            "residentScore": 3,
            "residentDesc": "1거주환경 설명",
            "recommendScore": 1,
            "recommendDesc": "1아파트추천",
            "age": "20대",
            "sex": "남자",
            "married": "미혼",
            "residenceTime": "2012~현재까지",
            "residenceType": "전세",
            "device": "WEB",
            "code":"",
            "dong": "",
            "floor":0,
        }
        var apt_name = getParameter('name');
        var apt_id = getParameter('id');
        var uuid = getParameter('uuid');
        var token = getParameter('token');
        var code = getParameter('code');
        var app_version = getParameter('app_version');
        var stepStatus = '';
        $(".apt_name").text(apt_name);

        $.ajax({
            type: "GET",
            url: api_host+"/v1/area/search?q=" + encodeURI(apt_name) + "&is_apt=true&all_dong=true",
            success: function (data) {
                if(data.danjis.length == 0) {
                    $("#i_dong").html("");
                    $("#i_dong").append('<input type="text" id="dong"  placeholder="동 입력"/>')
                    $("#i_dong").append('<input type="text" id="floor" placeholder="층 입력"/>')
                } else {
                    surveyItem.item.dongs =  data.danjis[0].dong;
                    for(var i=0; i<surveyItem.item.dongs.length; i++) {
                        $("#dong").append('<option value="' + surveyItem.item.dongs[i].name + '">' +surveyItem.item.dongs[i].name + '</option>')
                    }
                }
            },
            error:function(e){
                toast.show("에러가 발생했습니다 다시 시도해주세요")
            }
        });

        var stepSearch = {
            status: false,
            init: function() {
                stepSearch.status = true;
                stepSearch.show();

                $("#q_condition_yes").click(function() {
                    $("#q_condition_yes").addClass("active");
                    $("#q_condition_no").removeClass("active");
                    $("#btn_search_next").removeAttr("disabled");
                    //ga('send', 'event', '아파트리뷰1', '네', '클릭');
                });

                $("#q_condition_no").click(function() {
                    $("#q_condition_yes").removeClass("active");
                    $("#q_condition_no").addClass("active");
                    $("#btn_search_next").removeAttr("disabled");
                    //ga('send', 'event', '아파트리뷰1', '아니요', '클릭');
                });

                $("#btn_search_next").click(function() {
                    if( $("#q_condition_no").hasClass("active")){
                        messageStep.fail();
                    } else {
                        stepSearch.nextStep();
                    }

                    //ga('send', 'event', '아파트리뷰1', '다음', '클릭');
                })
            },
            show: function() {
                window.scrollTo(0,0)
                $(".step").hide();
                $("#step_search").show();
                stepStatus = "stepSearch";
                stepImg("1")
            },
            nextStep: function() {

                if(!step1.status) {
                    step1.init();
                } else {
                    step1.show();
                }

            }
        }

        var step1 = {
            status: false,
            step1Content: [],
            localItem: null,
            init: function() {
                step1.status = true;
                step1.show();

                $("#step_survey1 h4").click(function() {
                    var parentContainer = $(this).parent(".item_question");
                    var idx =  $("#step_survey1 h4").index($(this));

                    //ga('send', 'event', '아파트리뷰2', $(this).find("strong").text(), '클릭');
                    if($(parentContainer).hasClass("active")) {
                        $(parentContainer).removeClass("active");
                        step1.itemSave(parentContainer, idx);

                        window.scrollTo(0, 0);
                    } else {
                        if($(".item_question").hasClass("active")) {
                            step1.itemSave($(".item_question.active"), $(".item_question").index($(".item_question.active")));
                        }
                        $("#step_survey1 .item_question").removeClass("active");
                        $(parentContainer).addClass("active");

                        var parentTop =  $(parentContainer).position();
                        window.scrollTo(0,parentTop.top);
                    }

                });

                $(".item_question .i-star").click(function() {
                    var idx = ($(".item_question .i-star").index($(this)) % 5);
                    var parentContainer = $(this).parents(".item_question");
                    for(var i=0; i<5; i++) {
                        if(i <= idx) {
                            $(parentContainer).find(".i-star").eq(i).attr('class', "zbIcon i-star icon-star_on");
                        } else {
                            $(parentContainer).find(".i-star").eq(i).attr('class', "zbIcon i-star icon-star_off");
                        }
                    }

                });

                $("#btn_step1_next").click(function() {
                    if($(".item_question").hasClass("active")) {
                        step1.itemSave($(".item_question.active"), $(".item_question").index($(".item_question.active")));
                    }
                    //step1.itemSave(parentContainer, idx);

                    for(var i=0; i<5; i++) {
                        if(!step1.step1Content[i]) {
                            toast.show("모든 항목을 입력해주세요");
                            break;
                            return false;
                        }
                        if(!step1.lastValidation(step1.step1Content[i])) {
                            break;

                            return false;
                        }
                        if($("#dong option:selected").val() == "동 선택" || $("#floor option:selected").val() == "층 선택" || $("#dong").val() == "" || $("#floor").val() == ""  ) {
                            toast.show("동과 층을 선택해주세요");
                            break;
                            return false;
                        }
                        if(i==4) {
                            step1.nextStep();
                            //ga('send', 'event', '아파트리뷰2', '다음', '클릭');
                        }
                    }
                });

                $("#dong").change(function() {
                    $("#floor").html("<option>층 선택</option>");
                    for(var i=0; i<surveyItem.item.dongs.length; i++) {
                        if($("#dong").val() == surveyItem.item.dongs[i].name) {
                            for(var j=1; j <= surveyItem.item.dongs[i].floor; j++) {
                                $("#floor").append('<option value="' + j + '층">' + j + '층</option>')
                            }
                        }
                    }
                })
                $("#step_survey1 textarea").focusin(function() {
                    var t =  $(this).offset();
                    window.scrollTo(0,t.top);
                })
            },
            show: function() {
                window.scrollTo(0,0)
                $(".step").hide();
                $("#step_survey1").show();
                stepStatus = "step_survey1";
                stepImg("2")

            },
            itemSave: function(el, idx) {
                var obj = new Object;
                if($(el).data("question") != "q6") {
                    obj.title = $(el).find("h4 strong").text();
                    obj.contents = $(el).find(".i_textarea textarea").val();
                    obj.star = $(el).find(".icon-star_on").size();

                    step1.step1Content[idx] = obj;
                    step1.itemValidation(el, obj);
                } else {
                    if($("#dong option:selected").val() != "동 선택" && $("#floor option:selected").val() != "층 선택" && $("#dong").val() != "" && $("#floor").val() != ""  ) {
                        $(el).addClass("success")
                    } else {
                        $(el).removeClass("success")
                    }
                }
            },
            itemValidation: function(el, obj) {
                 if(obj.contents != "" && obj.contents.replace(/ /gi, "").length > 49 && obj.star != 0) {
                    $(el).addClass("success")
                } else {
                    $(el).removeClass("success")
                }
            },
            lastValidation: function(obj) {
                if(obj.contents.replace(/ /gi, "").length < 50) {
                    toast.show("["+ obj.title + "] <br /> 장단점을 50자 이상 <br /> 입력해주세요.")
                    return false;
                }
                if(obj.star == 0) {
                    toast.show("["+ obj.title + "] <br /> 별점 평가를 해주세요.")
                    return false;
                }
                return true;
            },
            nextStep: function() {
                surveySubmitItem.code = code;
                surveySubmitItem.trafficScore = step1.step1Content[0].star;
                surveySubmitItem.trafficDesc = step1.step1Content[0].contents;
                surveySubmitItem.aroundScore = step1.step1Content[1].star;
                surveySubmitItem.aroundDesc = step1.step1Content[1].contents;
                surveySubmitItem.careScore = step1.step1Content[2].star;
                surveySubmitItem.careDesc = step1.step1Content[2].contents;
                surveySubmitItem.residentScore = step1.step1Content[3].star;
                surveySubmitItem.residentDesc = step1.step1Content[3].contents;
                surveySubmitItem.recommendScore = step1.step1Content[4].star;
                surveySubmitItem.recommendDesc = step1.step1Content[4].contents;
                surveySubmitItem.dong =  $("#dong").val();
                surveySubmitItem.floor = parseInt($("#floor").val());
                
                $(".item_question").removeClass("active");

                if(!step2.status) {
                    step2.init();
                } else {
                    step2.show();
                }
            }
        }

        var step2 = {
            status: false,
            init: function() {
                step2.status = true;
                step2.show();

                //$("#btn_step2_next").attr("disabled", true)
                $("#step_survey2 .i_btn button").click(function() {
                    $(this).parent(".i_btn").find("button").removeClass("active");
                    $(this).addClass("active");
                    if($("#step_survey2 button.active").size() == 5) {
                        $("#btn_step2_next").removeAttr("disabled")
                    } else {
                        $("#btn_step2_next").attr("disabled", true)
                    }
                });

                $("#btn_step2_prev").click(function() {
                    step2.prevStep();
                })
                $("#btn_step2_next").click(function() {
                    surveySubmitItem.residenceType = $("#step_survey2 button.q_type.active").text();
                    surveySubmitItem.residenceTime =$("#step_survey2 button.q_time.active").text();
                    surveySubmitItem.age = $("#step_survey2 button.q_age.active").text();
                    surveySubmitItem.sex = $("#step_survey2 button.q_sex.active").text();
                    surveySubmitItem.married = $("#step_survey2 button.q_maried.active").text();

                    //alert("[리뷰 작성 완료]\n소중한 리뷰 감사합니다.\n작성해주신 리뷰는 심사 후 등록됩니다.")
                    //ga('send', 'event', '아파트리뷰3', '리뷰 제출하기', '클릭');
                    submit();
                })
            },

            prevStep: function() {
                if(!step1.status) {
                    step1.init();
                } else {
                    step1.show();
                }
            },
            show: function() {
                window.scrollTo(0,0)
                $(".step").hide();
                $("#step_survey2").show();
                stepStatus = "step_survey2";
                stepImg("3");
            }
        }


        function submit() {
            $("#dim").show();

            $.ajax({
                type: "POST",
                url:apis_host+"/property/apartments/" + apt_id + "/reviews/v1",
                crossDomain:true,
                headers: {
                    "ZigbangDeviceId":uuid,
                    "ZigbangUserToken":token
                },
                data: JSON.stringify(surveySubmitItem),
                success: function (args) {
                    if(args.errorMessage) {
                        toast.show("죄송합니다. 사용자가 너무 많아 설문저장이 지연되고 있습니다. \n 다시 입력 부탁드립니다")
                        $("#dim").hide();
                    } else {
                        alert("리뷰 작성 완료 \n소중한 리뷰 감사합니다.\n작성해주신 리뷰는 심사 후 등록됩니다.");

                        if( !detectmob() ){
                            window.close()
                        } else {
                            if (app_version && app_version.split(".")[0] >= 5){
                                window.parent.postMessage("ReviewDone", "*")
                            } else {
                                location.href="zigbang://app/apt/review/done";
                            }
                        }
                    }

                    //ga('send', 'event', '아파트리뷰4-앤딩', '완료', '클릭');
                },
                error:function(e){
                    toast.show("저장이 실패하였습니다.");
                    $("#dim").hide();
                }
            });

        }

        var messageStep = {
            fail: function() {
                stepImg("0");
                $(".step, #step_message .item").hide();
                $("#step_message").show();
                $("#i_fail").show();
                $("#btn_msg_1").click(function() {
                    //ga('send', 'event', '아파트리뷰1.5-미대상자', '확인', '클릭');
                    //location.href="https://www.zigbang.com";
                    if( !detectmob() ){
                        window.close()
                    } else {
                        if (app_version && app_version.split(".")[0] >= 5){
                            window.parent.postMessage("ReviewDone", "*")
                        } else {
                            location.href="zigbang://app/apt/review/done";
                        }
                    }
                })
            }
        }
        function stepImg(idx) {
            if(navigator.userAgent.match(/Android/i) )
            {

            }
        }

        var toast = {
            show: function(msg) {
                if($("#toast").is(":visible")) {
                    $("#toast").hide();
                    $("#toast p").html("")
                }
                $("#toast p").html(msg);
                $("#toast").fadeIn(500);
                setTimeout(function() {
                    toast.hide();
                }, 3000);
            },
            hide: function() {
                $("#toast").fadeOut(500, function() {
                    $("#toast p").html("")
                });
            }
        }

        function backEvent() {
            if(stepStatus == "step_survey2") {
                step2.prevStep();
            } else {
                if(confirm("작성을 취소하시겠습니까 ? \n 작성 중인 리뷰는 저장되지 않습니다 .")) {
                    return false;
                } else {
                    return false;
                }
            }
        }

        stepSearch.init();

        function chkword(obj, maxByte) {

            var strValue = obj.value.replace(/ /gi, "");
            var strLen = strValue.length;
            var totalByte = 0;
            var len = 0;
            var oneChar = "";
            var str2 = "";

            for (var i = 0; i < strLen; i++) {
                oneChar = strValue.charAt(i);
                

                if (escape(oneChar).length > 4) {
                    totalByte++;
                } else {
                    totalByte++;
                }

                // 입력한 문자 길이보다 넘치면 잘라내기 위해 저장
                if (totalByte <= maxByte) {
                    len = i + 1;
                }
            }

            // 넘어가는 글자는 자른다.
            if (totalByte >= maxByte) {
                //obj.parentNode.querySelector('.warn').style.display='block';
                obj.parentNode.querySelector('.warn').innerHTML=(maxByte + "자를 초과 입력 할 수 없습니다.");
                str2 = strValue.substr(0, len);
                obj.value = str2;
                //chkword(obj, maxByte);
            } else {
                //obj.parentNode.querySelector('.warn').style.display = 'none';
                obj.parentNode.querySelector('.warn').innerHTML=(totalByte + " / " + maxByte);
            }
        }

    </script>
</div>
</body>
</html>